// Generated by CoffeeScript 1.9.2
(function() {
  var Suggestions, dummyEasel, r;

  if (window.tacit == null) {
    window.tacit = {};
  }

  r = function() {
    return 2 * Math.random() - 1;
  };

  dummyEasel = (function() {
    function dummyEasel(suggestions, i1) {
      this.suggestions = suggestions;
      this.i = i1;
      null;
    }

    dummyEasel.prototype.mouseDown = function(easel, eventType, mouseLoc, object) {
      var drawpad, pad, scale;
      console.log(this.i);
      pad = this.suggestions.pads[this.i];
      drawpad = this.suggestions.project.easel.pad;
      scale = Math.min(pad.height / drawpad.height, pad.width / drawpad.width);
      this.suggestions.project.easel.pad.load(pad.sketch.structure, scale = pad.sketch.scale / scale);
      this.suggestions.project.easel.pad.sketch.onChange = (function(_this) {
        return function() {
          return _this.suggestions.update(_this.suggestions.project.easel.pad.sketch.structure);
        };
      })(this);
      this.suggestions.project.easel.pad.sketch.updateDrawing();
      undoredo.log();
      return false;
    };

    dummyEasel.prototype.allowPan = function() {
      return false;
    };

    dummyEasel.prototype.mouseUp = function(easel, eventType, mouseLoc, object) {
      return false;
    };

    dummyEasel.prototype.mouseMove = function(easel, eventType, mouseLoc, object) {
      return false;
    };

    return dummyEasel;

  })();

  Suggestions = (function() {
    function Suggestions(project, htmlLoc) {
      var i, j, structure;
      this.project = project;
      this.htmlLoc = htmlLoc;
      this.project.onChange = (function(_this) {
        return function() {
          return _this.update(_this.project.easel.pad.sketch.structure);
        };
      })(this);
      structure = new tacit.Structure(this.project.easel.pad.sketch.structure);
      this.pads = [];
      for (i = j = 0; j <= 2; i = ++j) {
        this.pads.push(new tacit.Pad(new dummyEasel(this, i), this.htmlLoc, 180, 180, structure));
      }
      this.update(structure);
    }

    Suggestions.prototype.mutate = function(structure) {
      var delta, dg, j, len, node, ref, results;
      ref = structure.nodeList;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        node = ref[j];
        dg = 200 * r() * structure.nodeList.length / structure.lp.obj;
        delta = {
          x: (node.fgrad.x * dg + (r() + 1) * node.grad.x * 1000) * !node.fixed.x,
          y: (node.fgrad.y * dg + (r() + 1) * node.grad.y * 1000) * !node.fixed.y,
          z: (node.fgrad.z * dg + (r() + 1) * node.grad.z * 1000) * !node.fixed.z
        };
        results.push(node.move(delta));
      }
      return results;
    };

    Suggestions.prototype.update = function(structure) {
      var draw, drawpad, j, len, pad, ref, results, scale;
      drawpad = this.project.easel.pad;
      ref = this.pads;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        pad = ref[j];
        structure = new tacit.Structure(structure);
        structure.solve();
        this.mutate(structure);
        pad.load(structure);
        pad.sketch.nodeSize = 0;
        pad.sketch.rect.attr("fill", "url(#grid)");
        pad.sketch.showforce = false;
        scale = Math.min(pad.height / drawpad.height, pad.width / drawpad.width);
        pad.sketch.rescale([drawpad.sketch.translate[0], drawpad.sketch.translate[1]], scale * drawpad.sketch.scale, draw = false);
        results.push(pad.sketch.updateDrawing());
      }
      return results;
    };

    return Suggestions;

  })();

  window.tacit.Suggestions = Suggestions;

}).call(this);
